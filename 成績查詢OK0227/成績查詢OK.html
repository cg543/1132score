<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8">
  <meta name="author" content="oxxo.studio">
  <meta name="copyright" content="oxxo.studio">
  <title>æˆç¸¾æŸ¥è©¢</title>
  <script src="https://code.jquery.com/jquery-1.9.1.js"></script>
  <style>
    input, select {
      width: 300px;
      font-size: 15px;
      margin: 2px 0;
      padding: 2px 5px;
    }

    body {
      font-size: 18px;
    }

    table {
      margin: 20px auto;
      border-collapse: collapse;
      width: 800px;
    }

    th, td {
      border: 1px solid #ddd;
      width: 70px;
      height: 60px;
      padding: 10px;
      text-align: center;
    }

    th {
      background-color: #f2f2f2;
    }
  </style>
</head>

<body>
  å­¸è™Ÿï¼š<input id="student"><br/> 
  é¸æ“‡èª²ç¨‹ï¼š
  <select id="sheetSelect">
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6">6</option>
    <option value="è‰ç¨¿åˆ†çµ„">è‰ç¨¿åˆ†çµ„</option>
    <option value="å°1">å°1</option>
    <option value="emailç¶²å€">emailç¶²å€</option>
    <option value="ç¶²é æŸ¥è©¢">ç¶²é æŸ¥è©¢</option>
  </select>
  <br/>
  <button id="sendBtn">æŸ¥è©¢</button><br/>
  <table id="show">
    <thead></thead>
    <tbody></tbody>
  </table>

  <script>
    var appUrl = 'https://script.google.com/macros/s/AKfycbzYpDRKB6ayemKFbKC8USFNsdz9CtHJ8WZjc1zl8pXYnSuY0h-1FakAYuii9M8AfOs6/exec';
    var sheetsUrl = 'https://docs.google.com/spreadsheets/d/16iaCWcfWUAlCVX9_0oFfyvaySxwUrxlf1xHtzlNTax0/edit?usp=sharing';

    document.getElementById("sendBtn").addEventListener("click", function () {
      var id = document.getElementById("student").value;
      var sheetName = document.getElementById("sheetSelect").value;  // å–å¾—é¸æ“‡çš„å­¸æœŸ
      
      console.log("è¼¸å…¥å€¼æ˜¯: " + id);
      console.log("é¸æ“‡çš„å­¸æœŸ: " + sheetName);
    
      var requestData = {
        url: sheetsUrl,
        name: sheetName,
        startColumn: id
      };
    
      fetch(appUrl, {
        method: "POST",
        redirect: "follow",
        headers: {
          "Content-Type": "text/plain;charset=utf-8",
        },
        body: JSON.stringify(requestData)
      })
      .then(response => response.json())
      .then(data => {
        console.log("æˆåŠŸ:", data);
      
        if (data.error) {
          alert(data.error);
        } else {
          var titles = data.title; // å–å¾—æ¨™é¡Œåˆ—
          var students = data.data; // å–å¾—æˆç¸¾æ•¸æ“š
      
          var tableHeader = document.querySelector("#show thead");
          var tableBody = document.querySelector("#show tbody");
      
          // æ¸…ç©ºè¡¨æ ¼
          tableHeader.innerHTML = "";
          tableBody.innerHTML = "";
      
          // ğŸ”¥ ç¢ºä¿è®€å–å®Œæ•´æ¨™é¡Œæ•¸é‡
          console.log("æ¨™é¡Œæ•¸é‡:", titles.length);
          console.log("æ•¸æ“šæ•¸é‡:", students.length);
      
          // å»ºç«‹è¡¨é ­
          var headerRow = document.createElement("tr");
          titles.forEach(title => {
            var th = document.createElement("th");
            th.innerText = title;
            headerRow.appendChild(th);
          });
          tableHeader.appendChild(headerRow);
      
          // å»ºç«‹æ•¸æ“šåˆ—
          var dataRow = document.createElement("tr");
          students.forEach(score => {
            var td = document.createElement("td");
            td.innerText = score ?? 0; // å¦‚æœæ˜¯ null æˆ– undefinedï¼Œé¡¯ç¤º 0
            dataRow.appendChild(td);
          });
          tableBody.appendChild(dataRow);
        }
      })
      .catch(error => console.error("éŒ¯èª¤:", error));
      
    });
    
  </script>

</body>

</html>
